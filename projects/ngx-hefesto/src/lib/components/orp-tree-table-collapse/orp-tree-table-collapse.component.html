<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
<style>
  :host {
    .ngx-datatable {
      &.dark {
        .op_button_icon:hover {
          box-shadow: #eeeeee 0 0 8px -2px, transparent 0 0 0 0;
        }
      }
      &.bootstrap {
        .op_button_icon:hover {
          box-shadow: #121212 0 0 8px -2px, transparent 0 0 0 0;
        }
      }
    }

    .ngx-datatable .datatable-body .datatable-row-detail {
      padding: 1rem;
    }

    .ngx-datatable .datatable-footer {
      overflow-y: hidden !important;
    }

    .ngx-datatable.dark .datatable-body .datatable-body-row .datatable-body-cell,
    .ngx-datatable.bootstrap .datatable-body .datatable-body-row .datatable-body-cell {
      padding-top: 8px;
      padding-bottom: 8px;

      &.icon_content_cell {
        display: grid !important;
        place-content: center !important;
        padding: 0 !important;
      }
    }
    .ngx-datatable.dark .datatable-header .datatable-header-cell,
    .ngx-datatable.bootstrap .datatable-header .datatable-header-cell {
      &.children_header {
        padding-top: 8px;
        padding-bottom: 8px;
        background: #d9d9d9;
      }
      &.children_row {
        padding-top: 8px;
        padding-bottom: 8px;
      }
    }
  }

  .py-2 {
    padding-top: 0.5rem !important;
    padding-bottom: 0.5rem !important;
  }

  .op_button_icon {
    align-items: center;
    background-color: #fff;
    border-radius: 8px;
    box-shadow: transparent 0 0 0 3px, rgba(18, 18, 18, .1) 0 6px 20px;
    box-sizing: border-box;
    color: #121212;
    cursor: pointer;
    display: inline-flex;
    font-size: 1.2rem;
    font-weight: 700;
    justify-content: center;
    line-height: 1;
    margin: 0;
    outline: none;
    padding: 0.3rem;
    text-decoration: none;
    transition: box-shadow .2s, -webkit-box-shadow .2s;
    white-space: nowrap;
    border: 0;
    user-select: none;
    -webkit-user-select: none;
    touch-action: manipulation;
  }

  .button_link {
    border-radius: 4px;
    border: 0;
    padding: 0.2rem 0.4rem;
    margin-right: .5rem;
    cursor: pointer;
  }

</style>
<ngx-datatable #treeTable *ngIf="dataTable.length > 0 else loading"
               [ngClass]="{
                 'dark': this.theme === opTreeThemeEnum.dark,
                 'bootstrap': this.theme === opTreeThemeEnum.light
               }"
               [rows]="dataTable"
               [columnMode]="columnMode.flex"
               [headerHeight]="tableRowHeight"
               [footerHeight]="30"
               [rowHeight]="tableRowHeight"
               [scrollbarV]="false"
               [sortType]="sortType.single"
               [limit]="limit"f

>
  <ngx-datatable-row-detail [rowHeight]="getDetailHeight()" style="padding: 1rem">
    <ng-template let-row="row" ngx-datatable-row-detail-template>
      <orp-tree-table-basic [rows]="row[childrenKey]" [columns]="childrenColumns" [limit]="childrenLimit"/>
    </ng-template>
  </ngx-datatable-row-detail>
  <ngx-datatable-column
    [width]="iconColumnWidth"
    [resizeable]="false"
    [sortable]="false"
    [draggable]="false"
    [canAutoResize]="false"
    cellClass="icon_content_cell"
    [cellTemplate]="iconCollapse"
  >

  </ngx-datatable-column>
  <ng-container>
    <ngx-datatable-column *ngFor="let item  of columns" [name]="item.name" [prop]="item.keyValue" [resizeable]="false" [flexGrow]="1"
                          [sortable]="!!item.sort"
                          headerClass="py-2"
                          cellClass="py-2">
      <ng-template let-column="column" ngx-datatable-header-template>
        <strong>{{ column.name }}</strong>
      </ng-template>
      <ng-template let-dataItem="row" ngx-datatable-cell-template>
        <span> {{ dataItem[item.keyValue] }}</span>
      </ng-template>
    </ngx-datatable-column>
    <ngx-datatable-column *ngIf="withActions && actionConfig.length > 0" name="'action'" prop="action" [resizeable]="false" [flexGrow]="1"
                          [sortable]="false"
                          headerClass="py-2"
                          cellClass="py-2">
      <ng-template ngx-datatable-header-template>
        <span></span>
      </ng-template>
      <ng-template let-dataItem="row" ngx-datatable-cell-template>
<!--        <ng-template [ngTemplateOutlet]="actionTemplate"></ng-template>-->
        <ng-container *ngFor="let action of actionConfig">
          <button class="button_link" [title]="action.tooltip" (click)="action.click(dataItem)">
            <span class="material-symbols-outlined">
              {{ action.icon.icon }}
            </span>
          </button>
        </ng-container>
      </ng-template>
    </ngx-datatable-column>
  </ng-container>
</ngx-datatable>
<ng-template #loading>
  <orp-spinner></orp-spinner>
</ng-template>
<ng-template #iconCollapse let-row="row" let-expanded="expanded" ngx-datatable-cell-template>
  <button class="op_button_icon" title="Expand/Collapse Row"
          [class.datatable-icon-right]="!expanded"
          [class.datatable-icon-down]="expanded"
          (click)="toggleExpandRow(row)">
  </button>
</ng-template>
